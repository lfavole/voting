{% extends "base.html" %}
{% block content %}
<h2>Your Voting Token</h2>
<p>Please keep this token safe. You will need it to cast your vote.</p>
<pre>{{ encrypted_message }}</pre>
<p><em>This token will not be shown again. If you lose it, you will not be able to vote.</em></p>
<script>
    // Save it in local storage
    window.addEventListener("DOMContentLoaded", async function() {
        const token = document.querySelector("pre").textContent;
        const buffer = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(document.querySelector("pre").textContent));
        const hashArray = Array.from(new Uint8Array(buffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        const key = "token_" + hashHex;
        localStorage.setItem(key, token);
    });
</script>
{% endblock %}
